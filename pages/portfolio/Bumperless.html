<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Jaume Albardaner</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../../assets/img/J.png" rel="icon">
  <link href="../../assets/img/J.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  
  <!-- Vendor CSS Files -->
  <link href="../../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../../assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: iPortfolio - v3.8.1
  * Template URL: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Mobile nav toggle button ======= -->
  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="../../assets/img/profile-img.jpg" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="../../index.html">Jaume Albardaner <br>i Torras</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="https://www.linkedin.com/in/jaumealbardaner/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
          <a href="mailto:jaumealbardaner@gmail.com" class="email"><i class="bi bi-envelope"></i></a>
          <a href="https://www.instagram.com/jaumealbardaner/" class="instagram"><i class="bi bi-instagram"></i></a>
          <a href="https://github.com/JaumeAlbardaner"><i class="bi bi-github"></i></a>
          <a href="https://scholar.google.com/citations?user=fzkBS-cAAAAJ"><i class="fas fa-graduation-cap google-scholar-icon"></i></a>
        </div>
      </div>

      <nav id="navbar" class="nav-menu navbar">
        <ul>
          <li><a href="../../index.html#hero" class="nav-link scrollto active"><i class="bx bx-home"></i> <span>Home</span></a></li>
          <li><a href="../../index.html#about" class="nav-link scrollto"><i class="bx bx-user"></i> <span>About</span></a></li>
          <li><a href="../../index.html#resume" class="nav-link scrollto"><i class="bx bx-file-blank"></i> <span>Resume</span></a></li>
          <li><a href="../../index.html#portfolio" class="nav-link scrollto"><i class="bx bx-book-content"></i> <span>Portfolio</span></a></li>
          <!-- <li><a href="#services" class="nav-link scrollto"><i class="bx bx-server"></i> <span>Services</span></a></li> -->
          <li><a href="../../index.html#contact" class="nav-link scrollto"><i class="bx bx-envelope"></i> <span>Contact</span></a></li>
        </ul>
      </nav><!-- .nav-menu -->
    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>Bumper(less) cars: advanced control and ROS2 implementation</h2>
          <ol>
            <li><a href="../../index.html">Home</a></li>
            <li>Bumper(less)</li>
          </ol>
        </div>

      </div>
    </section><!-- End Breadcrumbs -->

    <section class="inner-page">
      <div class="container">
        <br>
        <p><b>Level:</b> Big project (Master's thesis)
          <br>
          <b>GitHub Repository:</b> <a href="https://github.com/JaumeAlbardaner/collision_avoidance_TFM">https://github.com/JaumeAlbardaner/collision_avoidance_TFM</a>
          <br>
          <b>Grade:</b> 5.75/6.0 
          <br>
          <b>Publication:</b> <a href="https://www.iri.upc.edu/master_thesis/show/248">https://www.iri.upc.edu/master_thesis/show/248</a>
        </p>
        <div class="row justify-content-md-center">
          <div class="col-3">
            <img src="../../assets/img/portfolio/Bumperless/epfl-logo.png" class="img-fluid" alt="EPFL logo">
          </div>
          </div>
          <br>
        <h3>What are "Bumper(less) cars"?</h3>
        <p>
          Bumper cars are an amusement park ride consisting of several small electric cars designed to collide with one another. Nonetheless, the 
          usual objective of an actual car is to avoid collisions. To achieve such a goal, different collision avoidance mechanisms are in use and 
          under development today. To compare these algorithms, what a better place to run them than on an environment where colliding is the final goal?
        </p>
        <p>
          Hence, bumper(less) cars is the name of the platform where bumper cars are kept away from their final goal: colliding.
        </p>
        <br>
        <h3>Why bumper(less) cars?</h3>         
        <p>
          During my stay at the Dependable Control and Decision group (<a href="https://www.epfl.ch/labs/decode/">DECODE</a>) from the Laboratoire d'Automatique (<a href="https://www.epfl.ch/labs/la/">LA</a>) 
          at the École Polytechnique Fédérale de Lausanne (<a href="https://www.epfl.ch/en/">EPFL</a>), I was requested to implement a series of collision avoidance algorithms
          onto their motion capture system. The idea was to verify the results obtained in simulation on a real platform.
        </p>
        <br>
        <h3>Algorithms</h3>         
        <p>
          The algorithms that were considered for implementation in this project were the following:
          <ul>
            <li> <b>DWA:</b> <i> Dynamic Window Approach</i>. Given the current feasible inputs of the vehicle, choose the series of inputs that will not lead to collision and 
            will lead as close as possible to the desired configuration.</li>
            <li> <b>CBF:</b> <i>Collision Barrier Fuctions</i>. Minimizes the difference between the desired input and an input that will make the vehicle stay away from boundaries.
            For this algorithm boundaries are circles around obstacles that increase the cost of a trajectory to the point of solver's infeasibility.</li>
            <li> <b>C3BF:</b> <i>Collision Cone Control Barrier Functions</i>. Follows the same principle as CBF but rather than circles, the barrier function expands 
            towards the controlled car if they are facingeach other, thus the cone shape.</li>
            <li> <b>LBP:</b> <i>Lattice Based Planning</i>. Pre-computes feasible trajectories to reach certain configurations. Then, given a desired trajectory,
              chooses the pre-computed trajectory that differs the least from the desired one, and follows its commands.</li>
            <li> <b>MPC:</b> <i>Model Predictive Control</i>. In each timestep, a simulation is performed forward in time. Then, the input for each timestep is optimized to minimize a cost function,
              throughout the entire prediction horizon.</li>
            <li> <b>MPPI:</b> <i>Model Predictive Path Integral control</i>. In each timestep, a batch of simulations is performed forward in time. Then, each trajectory is weighted based 
              on a cost function and updates the distributions from which to sample. The weighted average of the inputs is performed at the first timestep, and the process is repeated.</li>
            </ul>
        </p>
        <br>
        <h3>The implementation</h3>
        <h4>The lab's setup</h4>
        <p>
          In the lab, there was a setup with motion capture cameras that could track accurately the position of the mini-cars.
          However, preference was put into working with the simulated environment, as it allowed for parallel advancements on different projects 
          without overlapping usage of the resources.
        </p>
        <p>
          Both of the environments were build to work with ROS2, so the algorithms could be tested in both environments without any changes in the code.
          The ROS2 structure of both environments can be seen below:
        </p>
        <div class="row justify-content-md-center" >
          <div class="col-lg-8" width="70%">
            <div class="portfolio-details-slider swiper">
              <div class="swiper-wrapper align-items-center">

                <div class="swiper-slide">
                  <img src="../../assets/img/portfolio/Bumperless/lab_sim.png" alt="Lab simulation environment" width="100%">
                </div>

                <div class="swiper-slide">
                  <img src="../../assets/img/portfolio/Bumperless/lab_real.png" alt="Lab mocap environment" width="100%">
                </div>
              </div>
              <div class="swiper-pagination"></div>
        </div></div></div>

        <br>

        <h4>Early stages: Making the multi-car system</h4>
        <p>
          Since up to this point there had not been any previous project in the lab with the objective of controlling multiple cars, 
          the system was not ready for such a task. The first step was to make the system multi-car. This was achieved by taking
          the existing code for a single car and running it in parallel for as many cars as desired.
          This was not as simple as running <i>N</i> instances of the same code, as some of the 
          information to be transmitted had been hardcoded for a single car.
        </p>

        <h4>Bringing the system from Python to ROS2</h4>
        <p>
          Now that the lab simulator was ready to take multiple cars, it was time to modify the existing implementation for the collision avoidance algorithms.
        </p>

        <h5>Initial implementation</h5>
        
        <p>
          The initial implementation of the algorithm included everything needed to run both with ROS2 and without it. Nonetheless, the provided code was 
          not made in a modular manner. This proved to be a nuisance when porting the algorithms to the lab's ROS2 simulator.
        </p>

        <p>
          The initial implementation for each of the algorithms can be seen below:
        </p>
        <br>
        <div class="row justify-content-md-center" >
          <div class="col-lg-8" width="70%">
            <div class="portfolio-details-slider swiper">
              <div class="swiper-wrapper align-items-center">

                <div class="swiper-slide">
                  <img src="../../assets/img/portfolio/Bumperless/DWA_class.drawio-1.png" alt="DWA structure" width="100%">
                </div>

                <div class="swiper-slide">
                  <img src="../../assets/img/portfolio/Bumperless/CBF_class.drawio-1.png" alt="CBF structure" width="100%">
                </div>

                <div class="swiper-slide">
                  <img src="../../assets/img/portfolio/Bumperless/LBP_class.drawio-1.png" alt="LBP structure" width="100%">
                </div>

                <div class="swiper-slide">
                  <img src="../../assets/img/portfolio/Bumperless/MPC_class.drawio-1.png" alt="MPC structure" width="100%">
                </div>

              </div>
              <div class="swiper-pagination"></div>
        </div></div></div>
        <br>
        <h5>Final implementation</h5>
        <p>
          After porting the system to a ROS2 architecture that would work with the setup on the lab, the node structure can be seen in the UML diagram below:
        </p>
        <br>
        <div class="row justify-content-md-center">
            <div class="col-10">
              <img src="../../assets/img/portfolio/Bumperless/ROS2_scheme1.png" class="img-fluid" alt="">
            </div>
        </div>
        <br>
        <br>

        <p>
          In the diagram, classes are grouped by their functionality within the system:
          <ul>
            <li> <b>Gray:</b> Classes that require communication with ROS2 topics/services. </li>
            <li> <b>Blue:</b> Classes that represent the main collision avoidance algorithms. </li>
            <li> <b>Green:</b> Classes that represent the car. </li>
          </ul>
        </p>

        <p>
          Some variables as well as some return types from functions can be seen highlighted in green the diagram. This is because 
          their type is a non-standard one, so it has been documented in the image below. Only the definition of 
          <a href="https://docs.ros.org/en/jade/api/geometry_msgs/html/msg/Pose2D.html">geometry_msgs/Pose2D</a> and 
          <a href="https://docs.ros.org/en/noetic/api/std_msgs/html/msg/Header.html">std_msgs/Header</a> 
          were not included, as they are standard ROS2 types.
        </p>

        <div class="row justify-content-md-center">
            <div class="col-5">
              <img src="../../assets/img/portfolio/Bumperless/ROS2_scheme3.png" class="img-fluid" alt="">
            </div>
        </div>
        <br>
        <p>
          Additionally, the types that were highlighted in light blue had to be custom made to be the response of a ROS2 service. 
          Since they are not standard ROS2 types, they have been documented in the images below.
        </p>

        <div class="row justify-content-md-center">
          <div class="col-5">
            <img src="../../assets/img/portfolio/Bumperless/ROS2_scheme2.png" class="img-fluid" alt="">
          </div>
        </div>
        <br>
        <p>
          For a more visual representation of what happens in an iteration of the algorithm, the diagram below was made. The steps that 
          are followed by the algorithm are the following:
          <ol>
            <li> When it's time to send a command to the car, a boolean in <b>CollisionAvoidanceNode</b> is set to <i>True</i>,
               so that the main loop can perform its computations. </li>
            <li> A query is sent to <b>JoySafetyNode</b>, to check if collision avoidance is activated. If not, the node returns the desired control from the user. </li>
            <li> The state of all cars is queried via <b>StateBufferNode</b>, and together with the desired control for the car, it's sent to the collision avoidance controller. </li>
            <li> The collision avoidance controller returns a command that will not end in collision whilst resembling the desired command as much as possible. </li>
            <li> The command is sent to the car (the safe one if collision avoidance is active, the desired one otherwise). The boolean is set to <i>False</i> again, making the main loop wait until the boolean is activated again. </li>
          </ol>
        </p>

        <div class="row justify-content-md-center">
            <div class="col-7">
              <img src="../../assets/img/portfolio/Bumperless/ROS2_scheme4.png" class="img-fluid" alt="">
            </div>
        </div>




        <br>
        <h3>Results</h3>
        <p>
          A system where cars can stop colliding with a press of a button was achieved, 
          as well as a system where multiple cars can be controlled at the same time. Watch the video below to see the system in action.
        </p>
        <!-- https://drive.google.com/file/d/1WuSQeau7cdOqU-QNzDtFplVOfwvdhbjK/view?usp=sharing -->
        <div class="row justify-content-md-center">
            <iframe style="width: 40vw; height:20vw;" src="https://drive.google.com/file/d/1WuSQeau7cdOqU-QNzDtFplVOfwvdhbjK/preview" allow="autoplay" allowfullscreen="allowfullscreen"></iframe>
        </div><br>        
    </section>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>iPortfolio</span></strong>
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/ -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer><!-- End  Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="../../assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="../../assets/vendor/aos/aos.js"></script>
  <script src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../../assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="../../assets/vendor/typed.js/typed.min.js"></script>
  <script src="../../assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="../../assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="../../assets/js/main.js"></script>

</body>

</html>